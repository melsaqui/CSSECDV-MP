<!DOCTYPE html>
<html>
    <head>    
        <meta charset="UTF-8">
        <title>Admin Panel</title>
 <!-- Import bootstrap cdn -->
 <link rel="stylesheet" href=
 "https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
         integrity=
 "sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
         crossorigin="anonymous">
 <!-- Import jquery cdn -->
 <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
 integrity=
"sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
 crossorigin="anonymous">
</script>
          
    <script src=
    "https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
            integrity=
    "sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
            crossorigin="anonymous">
        </script>
    </head>
    
    
<body>
<h1>Administration Panel</h1>
<p>Hello Admin {{ user }}</p>

{% block body %}
<style>
    table, th, td {
        border: 1px solid black;
        padding: 5px;
    }
    
</style>
<table>
    <tr>
        <th style="width: 300px">Users</th>
        <th style="width: 100px">Roles</th>
        <th style="width: 100px">Change Roles</th>
    </tr>

    {% for r in records %}
   
    <tr>
        <td> {{ r["email"] }} </td> 
        <td style = "text-align: center;"> {{ r["role"] }} </td>

        <td style = "text-align: center;">  
            <!--a href="/admin/change-role/{{r['id']}}"-->
                {% if r["role"] == 'Admin' %}
                <!--button style="width: 90px;">Downgrade</button-->
                <button style="width: 100px;" type="button" data-toggle="modal" class="btn btn-outline-danger" data-target="#role_change_{{r['id']}}">Downgrade</button>

                {% elif r["role"] == 'Regular' %}
                <button style="width: 100px" type="button" data-toggle="modal" class="btn btn-outline-success" data-target="#role_change_{{r['id']}}">Upgrade</button>
                {% endif %}
 
            <!--/a-->
        </td>
        <td style = "text-align: center;">  
            <a href="">
                {% if r["role"] == 'Regular' %}
                <button style="width: 90px;">Edit</button>
                {% endif %}
            </a>
        </td>
       <!--modal for role change-->
        <div class="modal fade" id="role_change_{{r['id']}}"role="dialog">
            <div class="modal-dialog">
               <!-- Modal content-->
               <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Delete a book</h4>
                </div>
                <form action="/admin/change-role/{{r['id']}}" method="post">
                    <div class="modal-body">
                        <div class="form-group row">
                            <label class="col-sm-12 col-form-label">Are you sure you want to change <span
                                    style='font-weight:bold'>{{r['email']}}</span>
                                    's role?</label>
    
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default"
                            data-dismiss="modal">Close</button>
                            {% if r["role"] == 'Admin' %}

                                <button type="submit" class="btn btn-danger">change</button>
                            {% else %}
                                <button type="submit" class="btn btn-success">change</button>
                            {% endif %}
                    </div>
                </form>
            </div>
            </div>
        </div>
      
            
    {% endfor %}
</table>

{% endblock %}

<section>
    <header>
      {% block header %}{% endblock header %}
      {% for category, message in get_flashed_messages(with_categories=true) %}
        {% if category=="error" %}
            <div style="color:red" class="flash {{ category }}">{{ message }}</div>
        {% else %}
            <div style="color:green" class="flash {{ category }}">{{ message }}</div>
        {% endif %}
        
      {% endfor %}
    </header>
   
  </section>
 
<p><a href ="/" class="btn">Back Home</a></p>
<p><a href="/logout" class="btn">Logout</a></p>
</body>
</html>